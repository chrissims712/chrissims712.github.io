<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
  <meta name="description" content="[Query features from a FeatureLayer - 4.2]">
  <!-- 
  ArcGIS API for JavaScript, https://js.arcgis.com
  For more information about the featurelayer-query sample, read the original sample description at developers.arcgis.com.
  https://developers.arcgis.com/javascript/latest/featurelayer-query/index.html  
  -->
  <title>Query features with my data INCOMPLETE - 4.2</title>

  <link rel="stylesheet" href="https://js.arcgis.com/4.2/esri/css/main.css">
  <script src="https://js.arcgis.com/4.2/"></script>

  <style>
    html,
    body,
    #viewDiv {
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    
    #infoDiv {
      background-color: white;
      color: black;
      padding: 6px;
      width: 400px;
    }
    
    #results {
      font-weight: bolder;
    }
  </style>

  <script>
  require([
        "esri/Map",
        "esri/views/MapView",
        "esri/layers/FeatureLayer",
        "esri/layers/GraphicsLayer",
        "esri/geometry/geometryEngine",
        "esri/Graphic",   
    
        "dojo/on",
        "dojo/dom",
        "dojo/dom-construct",
        "dojo/domReady!"
      ], function(
        Map, MapView,
        FeatureLayer,
        GraphicsLayer,
        geometryEngine,
        Graphic,
        on, dom, domConstruct
      ) {
        var trailURL = "https://services.arcgis.com/QWISJZQTqrWSOOHJ/arcgis/rest/services/TrailsFullMotorizedSPECIAL/FeatureServer/0";
    
        var nationalForests = new FeatureLayer({
          url: "https://services.arcgis.com/QWISJZQTqrWSOOHJ/arcgis/rest/services/National_Forests/FeatureServer/0",
          outFields: ["*"],
          visible: false
        });
    
    var motorizedTrails = new FeatureLayer({
      url: trailURL,
      outFields: ["*"],
      visible: false
    });
    
    var resultsLayer = new GraphicsLayer();
    
    var map = new Map({
      basemap: "topo",
      layers: [nationalForests, motorizedTrails, resultsLayer]
    });
    
    var view = new MapView({
      container: "viewDiv",
      map: map,
      center: [-97.75188, 37.23308],
      zoom: 4
    });
    view.ui.add("infoDiv", "top-right");
    
    //query of national forest layer
    view.then(function(){
      return nationalForests.then(function(){
        var query = nationalForests.createQuery();
        return nationalForests.queryFeatures(query);
      });
    })
    .then(getValues)
    .then(getUniqueValues)
    .then(addToSelect);
    
    //Return national forest attribute
    function getValues(response) {
          var features = response.features;
          var values = features.map(function(feature) {
            return feature.attributes.FORESTNAME;
          });
          return values;
        }
    
    
  </script>
  </head>

<body>

</body>

</html>